{"version":3,"sources":["../../../src/visualizations/pivot/Renderer.tsx"],"names":["VALID_OPTIONS","formatRows","rows","columns","row","value","key","name","type","Renderer","data","options","onOptionsChange","config","setConfig","dataRows","onChange","updatedOptions","validOptions","hideControls","hideRowTotals","hideColumnTotals","propTypes","RendererPropTypes","defaultProps"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;AACA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,aAAa,GAAG,CACpB,MADoB,EAEpB,MAFoB,EAGpB,MAHoB,EAIpB,gBAJoB,EAKpB,aALoB,EAMpB,SANoB,EAOpB,UAPoB,EAQpB,UARoB,EASpB,mBAToB,EAUpB,cAVoB,EAWpB,kBAXoB,EAYpB,uBAZoB,EAapB,oBAboB,EAcpB,WAdoB,EAepB,yBAfoB,EAgBpB,UAhBoB,EAiBpB,iBAjBoB,CAAtB;;AAoBA,SAASC,UAAT,OAA4C;AAAA,MAAtBC,IAAsB,QAAtBA,IAAsB;AAAA,MAAhBC,OAAgB,QAAhBA,OAAgB;AAC1C,SAAO,iBAAID,IAAJ,EAAUE,GAAG,IAAI,uBAAUA,GAAV,EAAe,CAACC,KAAD,EAAQC,GAAR,KAAgB,8BAAkBD,KAAlB,EAAyB,kBAAKF,OAAL,EAAc;AAAEI,IAAAA,IAAI,EAAED;AAAR,GAAd,EAA6BE,IAAtD,CAA/B,CAAjB,CAAP;AACD;;AAEc,SAASC,QAAT,QAA2D;AAAA,MAAvCC,IAAuC,SAAvCA,IAAuC;AAAA,MAAjCC,OAAiC,SAAjCA,OAAiC;AAAA,MAAxBC,eAAwB,SAAxBA,eAAwB;;AAAA,kBAC5C,uCAAcD,OAAd,EAD4C;AAAA;AAAA,MACjEE,MADiE;AAAA,MACzDC,SADyD;;AAExE,MAAMC,QAAQ,GAAG,oBAAQ,MAAMd,UAAU,CAACS,IAAD,CAAxB,EAAgC,CAACA,IAAD,CAAhC,CAAjB;AAEA,wBAAU,MAAM;AACdI,IAAAA,SAAS,mBAAMH,OAAN,EAAT;AACD,GAFD,EAEG,CAACA,OAAD,CAFH;;AAIA,MAAMK,QAAQ,GAAIC,cAAD,IAAyB;AACxC,QAAMC,YAAY,GAAG,kBAAKD,cAAL,EAAqBjB,aAArB,CAArB;AACAc,IAAAA,SAAS,mBAAMI,YAAN,EAAT;AACAN,IAAAA,eAAe,CAACM,YAAD,CAAf;AACD,GAJD,CARwE,CAcxE;;;AACA,MAAMC,YAAY,GAAG,iBAAIR,OAAJ,EAAa,kBAAb,CAArB;AACA,MAAMS,aAAa,GAAG,CAAC,iBAAIT,OAAJ,EAAa,iCAAb,CAAvB;AACA,MAAMU,gBAAgB,GAAG,CAAC,iBAAIV,OAAJ,EAAa,iCAAb,CAA1B;AACA,sBACE;AACE,IAAA,SAAS,EAAC,qCADZ;AAEE,0BAAoBQ,YAAY,IAAI,IAFtC;AAGE,4BAAsBC,aAAa,IAAI,IAHzC;AAIE,+BAAyBC,gBAAgB,IAAI,IAJ/C;AAKE,iBAAU;AALZ,kBAME,6BAAC,qBAAD,eAAkB,kBAAKR,MAAL,EAAab,aAAb,CAAlB;AAA+C,IAAA,IAAI,EAAEe,QAArD;AAA+D,IAAA,QAAQ,EAAEC;AAAzE,KANF,CADF;AAUD;;AAEDP,QAAQ,CAACa,SAAT,GAAqBC,4BAArB;AACAd,QAAQ,CAACe,YAAT,GAAwB;AAAEZ,EAAAA,eAAe,EAAE,MAAM,CAAE;AAA3B,CAAxB","sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { get, find, pick, map, mapValues } from \"lodash\";\r\n// @ts-expect-error ts-migrate(7016) FIXME: Could not find a declaration file for module 'reac... Remove this comment to see the full error message\r\nimport PivotTableUI from \"react-pivottable/PivotTableUI\";\r\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\r\nimport { formatColumnValue } from \"@/lib/utils\";\r\n\r\nimport \"react-pivottable/pivottable.css\";\r\nimport \"./renderer.less\";\r\n\r\nconst VALID_OPTIONS = [\r\n  \"rows\",\r\n  \"cols\",\r\n  \"vals\",\r\n  \"aggregatorName\",\r\n  \"valueFilter\",\r\n  \"sorters\",\r\n  \"rowOrder\",\r\n  \"colOrder\",\r\n  \"derivedAttributes\",\r\n  \"rendererName\",\r\n  \"hiddenAttributes\",\r\n  \"hiddenFromAggregators\",\r\n  \"hiddenFromDragDrop\",\r\n  \"menuLimit\",\r\n  \"unusedOrientationCutoff\",\r\n  \"controls\",\r\n  \"rendererOptions\",\r\n];\r\n\r\nfunction formatRows({ rows, columns }: any) {\r\n  return map(rows, row => mapValues(row, (value, key) => formatColumnValue(value, find(columns, { name: key }).type)));\r\n}\r\n\r\nexport default function Renderer({ data, options, onOptionsChange }: any) {\r\n  const [config, setConfig] = useState({ ...options });\r\n  const dataRows = useMemo(() => formatRows(data), [data]);\r\n\r\n  useEffect(() => {\r\n    setConfig({ ...options });\r\n  }, [options]);\r\n\r\n  const onChange = (updatedOptions: any) => {\r\n    const validOptions = pick(updatedOptions, VALID_OPTIONS);\r\n    setConfig({ ...validOptions });\r\n    onOptionsChange(validOptions);\r\n  };\r\n\r\n  // Legacy behavior: hideControls when controls.enabled is true\r\n  const hideControls = get(options, \"controls.enabled\");\r\n  const hideRowTotals = !get(options, \"rendererOptions.table.rowTotals\");\r\n  const hideColumnTotals = !get(options, \"rendererOptions.table.colTotals\");\r\n  return (\r\n    <div\r\n      className=\"pivot-table-visualization-container\"\r\n      data-hide-controls={hideControls || null}\r\n      data-hide-row-totals={hideRowTotals || null}\r\n      data-hide-column-totals={hideColumnTotals || null}\r\n      data-test=\"PivotTableVisualization\">\r\n      <PivotTableUI {...pick(config, VALID_OPTIONS)} data={dataRows} onChange={onChange} />\r\n    </div>\r\n  );\r\n}\r\n\r\nRenderer.propTypes = RendererPropTypes;\r\nRenderer.defaultProps = { onOptionsChange: () => {} };\r\n"],"file":"Renderer.js"}