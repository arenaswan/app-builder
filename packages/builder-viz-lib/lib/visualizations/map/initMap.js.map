{"version":3,"sources":["../../../src/visualizations/map/initMap.ts"],"names":["L","Icon","Default","mergeOptions","iconUrl","markerIcon","iconRetinaUrl","markerIconRetina","shadowUrl","markerShadow","prototype","_getIconUrl","iconAnchors","marker","circle","rectangle","doughnut","popupAnchors","createHeatpointMarker","lat","lon","color","circleMarker","fillColor","fillOpacity","stroke","MarkerClusterIcon","DivIcon","extend","options","className","iconSize","Point","createIcon","textColor","borderColor","alpha","css","backgroundColor","args","icon","call","innerHTML","html","style","background","markerClusterIcon","createIconMarker","iconShape","iconFont","foregroundColor","BeautifyIcon","iconAnchor","popupAnchor","prefix","createMarkerClusterGroup","markerClusterGroup","iconCreateFunction","cluster","getChildCount","createMarkersLayer","points","classify","clusterMarkers","customizeMarkers","result","featureGroup","row","rowCopy","latColName","lonColName","tooltip","enabled","template","bindTooltip","popup","bindPopup","v","k","join","addLayer","initMap","container","_map","map","center","zoom","scrollWheelZoom","fullscreenControl","_tileLayer","tileLayer","attribution","addTo","_markerLayers","_layersControls","control","layers","onBoundsChange","boundsChangedFromMap","onMapMoveEnd","getBounds","on","off","updateLayers","groups","setUrl","mapTileUrl","eachLayer","layer","removeLayer","group","addOverlay","name","length","remove","updateBounds","bounds","latLngBounds","_southWest","lng","_northEast","isValid","fitBounds","animate","duration","unwatchResize","invalidateSize","value","destroy"],"mappings":"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","sourcesContent":["import { isFunction, each, map, toString, clone } from \"lodash\";\r\nimport chroma from \"chroma-js\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet.markercluster\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport \"leaflet.markercluster/dist/MarkerCluster.css\";\r\nimport \"leaflet.markercluster/dist/MarkerCluster.Default.css\";\r\nimport \"beautifymarker\";\r\nimport \"beautifymarker/leaflet-beautify-marker-icon.css\";\r\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-ico... Remove this comment to see the full error message\r\nimport markerIcon from \"leaflet/dist/images/marker-icon.png\";\r\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-ico... Remove this comment to see the full error message\r\nimport markerIconRetina from \"leaflet/dist/images/marker-icon-2x.png\";\r\n// @ts-expect-error ts-migrate(2307) FIXME: Cannot find module 'leaflet/dist/images/marker-sha... Remove this comment to see the full error message\r\nimport markerShadow from \"leaflet/dist/images/marker-shadow.png\";\r\nimport \"leaflet-fullscreen\";\r\nimport \"leaflet-fullscreen/dist/leaflet.fullscreen.css\";\r\nimport { formatSimpleTemplate } from \"@/lib/value-format\";\r\nimport sanitize from \"@/services/sanitize\";\r\nimport resizeObserver from \"@/services/resizeObserver\";\r\nimport chooseTextColorForBackground from \"@/lib/chooseTextColorForBackground\";\r\n\r\n// This is a workaround for an issue with giving Leaflet load the icon on its own.\r\nL.Icon.Default.mergeOptions({\r\n  iconUrl: markerIcon,\r\n  iconRetinaUrl: markerIconRetina,\r\n  shadowUrl: markerShadow,\r\n});\r\n\r\n// @ts-expect-error ts-migrate(2339) FIXME: Property '_getIconUrl' does not exist on type 'Def... Remove this comment to see the full error message\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\n\r\nconst iconAnchors = {\r\n  marker: [14, 32],\r\n  circle: [10, 10],\r\n  rectangle: [11, 11],\r\n  \"circle-dot\": [1, 2],\r\n  \"rectangle-dot\": [1, 2],\r\n  doughnut: [8, 8],\r\n};\r\n\r\nconst popupAnchors = {\r\n  rectangle: [0, -3],\r\n  circle: [1, -3],\r\n};\r\n\r\nconst createHeatpointMarker = (lat: any, lon: any, color: any) =>\r\n  L.circleMarker([lat, lon], { fillColor: color, fillOpacity: 0.9, stroke: false });\r\n\r\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'MarkerClusterIcon' does not exist on typ... Remove this comment to see the full error message\r\nL.MarkerClusterIcon = L.DivIcon.extend({\r\n  options: {\r\n    color: null,\r\n    className: \"marker-cluster\",\r\n    iconSize: new L.Point(40, 40),\r\n  },\r\n  // @ts-expect-error ts-migrate(7019) FIXME: Rest parameter 'args' implicitly has an 'any[]' ty... Remove this comment to see the full error message\r\n  createIcon(...args) {\r\n    const color = chroma(this.options.color);\r\n    const textColor = chooseTextColorForBackground(color);\r\n    const borderColor = color.alpha(0.4).css();\r\n    const backgroundColor = color.alpha(0.8).css();\r\n\r\n    const icon = L.DivIcon.prototype.createIcon.call(this, ...args);\r\n    icon.innerHTML = `\r\n      <div style=\"background: ${backgroundColor}\">\r\n        <span style=\"color: ${textColor}\">${toString(this.options.html)}</span>\r\n      </div>\r\n    `;\r\n    icon.style.background = borderColor;\r\n    return icon;\r\n  },\r\n});\r\n// @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterIcon' does not exist on typ... Remove this comment to see the full error message\r\nL.markerClusterIcon = (...args) => new L.MarkerClusterIcon(...args);\r\n\r\nfunction createIconMarker(\r\n  lat: any,\r\n  lon: any,\r\n  { iconShape, iconFont, foregroundColor, backgroundColor, borderColor }: any\r\n) {\r\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'BeautifyIcon' does not exist on type 'ty... Remove this comment to see the full error message\r\n  const icon = L.BeautifyIcon.icon({\r\n    iconShape,\r\n    icon: iconFont,\r\n    iconSize: iconShape === \"rectangle\" ? [22, 22] : false,\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    iconAnchor: iconAnchors[iconShape],\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    popupAnchor: popupAnchors[iconShape],\r\n    prefix: \"fa\",\r\n    textColor: foregroundColor,\r\n    backgroundColor,\r\n    borderColor,\r\n  });\r\n\r\n  return L.marker([lat, lon], { icon });\r\n}\r\n\r\nfunction createMarkerClusterGroup(color: any) {\r\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterGroup' does not exist on ty... Remove this comment to see the full error message\r\n  return L.markerClusterGroup({\r\n    iconCreateFunction(cluster: any) {\r\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'markerClusterIcon' does not exist on typ... Remove this comment to see the full error message\r\n      return L.markerClusterIcon({ color, html: cluster.getChildCount() });\r\n    },\r\n  });\r\n}\r\n\r\nfunction createMarkersLayer(options: any, { color, points }: any) {\r\n  const { classify, clusterMarkers, customizeMarkers } = options;\r\n\r\n  const result = clusterMarkers ? createMarkerClusterGroup(color) : L.featureGroup();\r\n\r\n  // create markers\r\n  each(points, ({ lat, lon, row }) => {\r\n    const rowCopy = clone(row);\r\n    rowCopy[options.latColName] = lat;\r\n    rowCopy[options.lonColName] = lon;\r\n\r\n    let marker;\r\n    if (classify) {\r\n      marker = createHeatpointMarker(lat, lon, color);\r\n    } else {\r\n      if (customizeMarkers) {\r\n        marker = createIconMarker(lat, lon, options);\r\n      } else {\r\n        marker = L.marker([lat, lon]);\r\n      }\r\n    }\r\n\r\n    if (options.tooltip.enabled) {\r\n      if (options.tooltip.template !== \"\") {\r\n        marker.bindTooltip(sanitize(formatSimpleTemplate(options.tooltip.template, rowCopy)));\r\n      } else {\r\n        marker.bindTooltip(`\r\n          <strong>${lat}, ${lon}</strong>\r\n        `);\r\n      }\r\n    }\r\n\r\n    if (options.popup.enabled) {\r\n      if (options.popup.template !== \"\") {\r\n        marker.bindPopup(sanitize(formatSimpleTemplate(options.popup.template, rowCopy)));\r\n      } else {\r\n        marker.bindPopup(`\r\n          <ul style=\"list-style-type: none; padding-left: 0\">\r\n            <li><strong>${lat}, ${lon}</strong>\r\n            ${map(row, (v, k) => `<li>${k}: ${v}</li>`).join(\"\")}\r\n          </ul>\r\n        `);\r\n      }\r\n    }\r\n    result.addLayer(marker);\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport default function initMap(container: any) {\r\n  const _map = L.map(container, {\r\n    center: [0.0, 0.0],\r\n    zoom: 1,\r\n    scrollWheelZoom: false,\r\n    // @ts-expect-error ts-migrate(2345) FIXME: Argument of type '{ center: [number, number]; zoom... Remove this comment to see the full error message\r\n    fullscreenControl: true,\r\n  });\r\n  const _tileLayer = L.tileLayer(\"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n  }).addTo(_map);\r\n  const _markerLayers = L.featureGroup().addTo(_map);\r\n  const _layersControls = L.control.layers().addTo(_map);\r\n\r\n  let onBoundsChange = () => {};\r\n\r\n  let boundsChangedFromMap = false;\r\n  const onMapMoveEnd = () => {\r\n    // @ts-expect-error ts-migrate(2554) FIXME: Expected 0 arguments, but got 1.\r\n    onBoundsChange(_map.getBounds());\r\n  };\r\n  _map.on(\"focus\", () => {\r\n    boundsChangedFromMap = true;\r\n    _map.on(\"moveend\", onMapMoveEnd);\r\n  });\r\n  _map.on(\"blur\", () => {\r\n    _map.off(\"moveend\", onMapMoveEnd);\r\n    boundsChangedFromMap = false;\r\n  });\r\n\r\n  function updateLayers(groups: any, options: any) {\r\n    _tileLayer.setUrl(options.mapTileUrl);\r\n\r\n    _markerLayers.eachLayer(layer => {\r\n      _markerLayers.removeLayer(layer);\r\n      _layersControls.removeLayer(layer);\r\n    });\r\n\r\n    each(groups, group => {\r\n      const layer = createMarkersLayer(options, group);\r\n      _markerLayers.addLayer(layer);\r\n      _layersControls.addOverlay(layer, group.name);\r\n    });\r\n\r\n    // hide layers control if it is empty\r\n    if (groups.length > 0) {\r\n      _layersControls.addTo(_map);\r\n    } else {\r\n      _layersControls.remove();\r\n    }\r\n  }\r\n\r\n  function updateBounds(bounds: any) {\r\n    if (!boundsChangedFromMap) {\r\n      bounds = bounds\r\n        ? L.latLngBounds([bounds._southWest.lat, bounds._southWest.lng], [bounds._northEast.lat, bounds._northEast.lng])\r\n        : _markerLayers.getBounds();\r\n      if (bounds.isValid()) {\r\n        _map.fitBounds(bounds, { animate: false, duration: 0 });\r\n      }\r\n    }\r\n  }\r\n\r\n  const unwatchResize = resizeObserver(container, () => {\r\n    _map.invalidateSize(false);\r\n  });\r\n\r\n  return {\r\n    get onBoundsChange() {\r\n      return onBoundsChange;\r\n    },\r\n    set onBoundsChange(value) {\r\n      onBoundsChange = isFunction(value) ? value : () => {};\r\n    },\r\n    updateLayers,\r\n    updateBounds,\r\n    destroy() {\r\n      unwatchResize();\r\n      _map.remove();\r\n    },\r\n  };\r\n}\r\n"],"file":"initMap.js"}