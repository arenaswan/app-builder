{"version":3,"sources":["../../../src/visualizations/map/prepareData.ts"],"names":["prepareData","data","options","colorScale","d3","scale","category10","classify","latColName","lonColName","pointGroups","rows","All","name","points","row","lat","lon","length","result","groups","color"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEe,SAASA,WAAT,CAAqBC,IAArB,EAAgCC,OAAhC,EAA8C;AAC3D;AACA,MAAMC,UAAU,GAAGC,WAAGC,KAAH,CAASC,UAAT,EAAnB;;AAF2D,MAInDC,QAJmD,GAIdL,OAJc,CAInDK,QAJmD;AAAA,MAIzCC,UAJyC,GAIdN,OAJc,CAIzCM,UAJyC;AAAA,MAI7BC,UAJ6B,GAIdP,OAJc,CAI7BO,UAJ6B;AAM3D,MAAMC,WAAW,GAAGH,QAAQ,GAAG,qBAAQN,IAAI,CAACU,IAAb,EAAmBJ,QAAnB,CAAH,GAAkC;AAAEK,IAAAA,GAAG,EAAEX,IAAI,CAACU;AAAZ,GAA9D;AAEA,SAAO,oBACL,iBAAID,WAAJ,EAAiB,CAACC,IAAD,EAAOE,IAAP,KAAgB;AAC/B,QAAMC,MAAM,GAAG,oBACb,iBAAIH,IAAJ,EAAUI,GAAG,IAAI;AACf,UAAMC,GAAG,GAAGD,GAAG,CAACP,UAAD,CAAf;AACA,UAAMS,GAAG,GAAGF,GAAG,CAACN,UAAD,CAAf;;AACA,UAAI,mBAAMO,GAAN,KAAc,mBAAMC,GAAN,CAAlB,EAA8B;AAC5B,eAAO,IAAP;AACD;;AACD,aAAO;AAAED,QAAAA,GAAF;AAAOC,QAAAA,GAAP;AAAYF,QAAAA,GAAG,EAAE,kBAAKA,GAAL,EAAU,CAACP,UAAD,EAAaC,UAAb,CAAV;AAAjB,OAAP;AACD,KAPD,CADa,CAAf;;AAUA,QAAIK,MAAM,CAACI,MAAP,KAAkB,CAAtB,EAAyB;AACvB,aAAO,IAAP;AACD;;AAED,QAAMC,MAAM,GAAG,oBAAO,EAAP,EAAWjB,OAAO,CAACkB,MAAR,CAAeP,IAAf,CAAX,EAAiC;AAAEA,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAAjC,CAAf;;AACA,QAAI,mBAAMK,MAAM,CAACE,KAAb,CAAJ,EAAyB;AACvBF,MAAAA,MAAM,CAACE,KAAP,GAAelB,UAAU,CAACU,IAAD,CAAzB;AACD;;AAED,WAAOM,MAAP;AACD,GArBD,CADK,CAAP;AAwBD","sourcesContent":["import d3 from \"d3\";\r\nimport { isNil, extend, map, filter, groupBy, omit } from \"lodash\";\r\n\r\nexport default function prepareData(data: any, options: any) {\r\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'scale' does not exist on type 'typeof im... Remove this comment to see the full error message\r\n  const colorScale = d3.scale.category10();\r\n\r\n  const { classify, latColName, lonColName } = options;\r\n\r\n  const pointGroups = classify ? groupBy(data.rows, classify) : { All: data.rows };\r\n\r\n  return filter(\r\n    map(pointGroups, (rows, name) => {\r\n      const points = filter(\r\n        map(rows, row => {\r\n          const lat = row[latColName];\r\n          const lon = row[lonColName];\r\n          if (isNil(lat) || isNil(lon)) {\r\n            return null;\r\n          }\r\n          return { lat, lon, row: omit(row, [latColName, lonColName]) };\r\n        })\r\n      );\r\n      if (points.length === 0) {\r\n        return null;\r\n      }\r\n\r\n      const result = extend({}, options.groups[name], { name, points });\r\n      if (isNil(result.color)) {\r\n        result.color = colorScale(name);\r\n      }\r\n\r\n      return result;\r\n    })\r\n  );\r\n}\r\n"],"file":"prepareData.js"}