{"version":3,"sources":["../../../../src/visualizations/funnel/Renderer/index.tsx"],"names":["generateRowKeyPrefix","Math","trunc","random","Number","MAX_SAFE_INTEGER","toString","Renderer","data","options","funnelData","rows","rowKeyPrefix","formatValue","numberFormat","formatPercentValue","format","percentFormat","value","percentValuesRange","min","max","columns","length","maxToPrevious","d","isFinite","pctPrevious","title","stepCol","displayAs","dataIndex","width","className","render","text","valueCol","align","item","ColorPalette","Cyan","pctMax","record","index","propTypes","RendererPropTypes"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AACA;;;;;;;;AAEA,SAASA,oBAAT,GAAgC;AAC9B,SAAOC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBC,MAAM,CAACC,gBAAlC,EAAoDC,QAApD,CAA6D,EAA7D,IAAmE,GAA1E;AACD;;AAEc,SAASC,QAAT,OAA0C;AAAA,MAAtBC,IAAsB,QAAtBA,IAAsB;AAAA,MAAhBC,OAAgB,QAAhBA,OAAgB;AACvD,MAAMC,UAAU,GAAG,oBAAQ,MAAM,0BAAYF,IAAI,CAACG,IAAjB,EAAuBF,OAAvB,CAAd,EAA+C,CAACD,IAAD,EAAOC,OAAP,CAA/C,CAAnB,CADuD,CAEvD;;AACA,MAAMG,YAAY,GAAG,oBAAQ,MAAMZ,oBAAoB,EAAlC,EAAsC,CAACU,UAAD,CAAtC,CAArB;AAEA,MAAMG,WAAW,GAAG,oBAAQ,MAAM,wCAAsBJ,OAAO,CAACK,YAA9B,CAAd,EAA2D,CAACL,OAAO,CAACK,YAAT,CAA3D,CAApB;AAEA,MAAMC,kBAAkB,GAAG,oBAAQ,MAAM;AACvC,QAAMC,MAAM,GAAG,wCAAsBP,OAAO,CAACQ,aAA9B,CAAf;AACA,WAAQC,KAAD,IAAgB;AACrB,UAAIA,KAAK,GAAGT,OAAO,CAACU,kBAAR,CAA2BC,GAAvC,EAA4C;AAC1C,0BAAWJ,MAAM,CAACP,OAAO,CAACU,kBAAR,CAA2BC,GAA5B,CAAjB;AACD;;AACD,UAAIF,KAAK,GAAGT,OAAO,CAACU,kBAAR,CAA2BE,GAAvC,EAA4C;AAC1C,0BAAWL,MAAM,CAACP,OAAO,CAACU,kBAAR,CAA2BE,GAA5B,CAAjB;AACD;;AACD,aAAOL,MAAM,CAACE,KAAD,CAAb;AACD,KARD;AASD,GAX0B,EAWxB,CAACT,OAAO,CAACQ,aAAT,EAAwBR,OAAO,CAACU,kBAAhC,CAXwB,CAA3B;AAaA,MAAMG,OAAO,GAAG,oBAAQ,MAAM;AAC5B,QAAIZ,UAAU,CAACa,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,aAAO,EAAP;AACD,KAH2B,CAK5B;;;AACA,QAAMC,aAAa,GAAG,mBAAMd,UAAN,EAAkBe,CAAC,IAAKC,QAAQ,CAACD,CAAC,CAACE,WAAH,CAAR,GAA0BF,CAAC,CAACE,WAA5B,GAA0C,CAAlE,EAAsEA,WAA5F;AACA,WAAO,CACL;AACEC,MAAAA,KAAK,EAAEnB,OAAO,CAACoB,OAAR,CAAgBC,SADzB;AAEEC,MAAAA,SAAS,EAAE,MAFb;AAGEC,MAAAA,KAAK,EAAE,KAHT;AAIEC,MAAAA,SAAS,EAAE,eAJb;AAKEC,MAAAA,MAAM,EAAGC,IAAD,iBACN,6BAAC,gBAAD;AAAS,QAAA,KAAK,EAAEA,IAAhB;AAAsB,QAAA,eAAe,EAAE,CAAvC;AAA0C,QAAA,eAAe,EAAE;AAA3D,SACGA,IADH;AANJ,KADK,EAYL;AACEP,MAAAA,KAAK,EAAEnB,OAAO,CAAC2B,QAAR,CAAiBN,SAD1B;AAEEC,MAAAA,SAAS,EAAE,OAFb;AAGEC,MAAAA,KAAK,EAAE,KAHT;AAIEK,MAAAA,KAAK,EAAE,QAJT;AAKEH,MAAAA,MAAM,EAAE,CAAChB,KAAD,EAAaoB,IAAb;AAAA;AACN;AACA,mCAAC,kBAAD;AAAW,QAAA,KAAK,EAAC,QAAjB;AAA0B,QAAA,KAAK,EAAEC,sBAAaC,IAA9C;AAAoD,QAAA,KAAK,EAAEF,IAAI,CAACG;AAAhE,SACG5B,WAAW,CAACK,KAAD,CADd;AAPJ,KAZK,EAwBL;AACEU,MAAAA,KAAK,EAAE,OADT;AAEEG,MAAAA,SAAS,EAAE,QAFb;AAGEC,MAAAA,KAAK,EAAE,KAHT;AAIEK,MAAAA,KAAK,EAAE,QAJT;AAKEH,MAAAA,MAAM,EAAGhB,KAAD,IAAgBH,kBAAkB,CAACG,KAAD;AAL5C,KAxBK,EA+BL;AACEU,MAAAA,KAAK,EAAE,YADT;AAEEG,MAAAA,SAAS,EAAE,aAFb;AAGEC,MAAAA,KAAK,EAAE,KAHT;AAIEK,MAAAA,KAAK,EAAE,QAJT;AAKEH,MAAAA,MAAM,EAAGhB,KAAD;AAAA;AACN;AACA,mCAAC,kBAAD;AAAW,QAAA,SAAS,EAAC,uBAArB;AAA6C,QAAA,KAAK,EAAGA,KAAK,GAAGM,aAAT,GAA0B;AAA9E,SACGT,kBAAkB,CAACG,KAAD,CADrB;AAPJ,KA/BK,CAAP;AA4CD,GAnDe,EAmDb,CAACT,OAAO,CAACoB,OAAR,CAAgBC,SAAjB,EAA4BrB,OAAO,CAAC2B,QAAR,CAAiBN,SAA7C,EAAwDpB,UAAxD,EAAoEG,WAApE,EAAiFE,kBAAjF,CAnDa,CAAhB;;AAqDA,MAAIL,UAAU,CAACa,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,WAAO,IAAP;AACD;;AAED,sBACE;AAAK,IAAA,SAAS,EAAC;AAAf,kBACE,6BAAC,cAAD,CACE;AADF;AAEE,IAAA,OAAO,EAAED,OAFX;AAGE,IAAA,UAAU,EAAEZ,UAHd;AAIE,IAAA,MAAM,EAAE,CAACgC,MAAD,EAASC,KAAT,KAAmB/B,YAAY,GAAG+B,KAJ5C;AAKE,IAAA,UAAU,EAAE;AALd,IADF,CADF;AAWD;;AAEDpC,QAAQ,CAACqC,SAAT,GAAqBC,4BAArB","sourcesContent":["import { maxBy } from \"lodash\";\r\nimport React, { useMemo } from \"react\";\r\nimport Table from \"antd/lib/table\";\r\nimport Tooltip from \"antd/lib/tooltip\";\r\nimport { RendererPropTypes } from \"@/visualizations/prop-types\";\r\nimport ColorPalette from \"@/visualizations/ColorPalette\";\r\nimport { createNumberFormatter } from \"@/lib/value-format\";\r\n\r\nimport prepareData from \"./prepareData\";\r\nimport FunnelBar from \"./FunnelBar\";\r\nimport \"./index.less\";\r\n\r\nfunction generateRowKeyPrefix() {\r\n  return Math.trunc(Math.random() * Number.MAX_SAFE_INTEGER).toString(36) + \":\";\r\n}\r\n\r\nexport default function Renderer({ data, options }: any) {\r\n  const funnelData = useMemo(() => prepareData(data.rows, options), [data, options]);\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const rowKeyPrefix = useMemo(() => generateRowKeyPrefix(), [funnelData]);\r\n\r\n  const formatValue = useMemo(() => createNumberFormatter(options.numberFormat), [options.numberFormat]);\r\n\r\n  const formatPercentValue = useMemo(() => {\r\n    const format = createNumberFormatter(options.percentFormat);\r\n    return (value: any) => {\r\n      if (value < options.percentValuesRange.min) {\r\n        return `<${format(options.percentValuesRange.min)}`;\r\n      }\r\n      if (value > options.percentValuesRange.max) {\r\n        return `>${format(options.percentValuesRange.max)}`;\r\n      }\r\n      return format(value);\r\n    };\r\n  }, [options.percentFormat, options.percentValuesRange]);\r\n\r\n  const columns = useMemo(() => {\r\n    if (funnelData.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    // @ts-expect-error ts-migrate(2532) FIXME: Object is possibly 'undefined'.\r\n    const maxToPrevious = maxBy(funnelData, d => (isFinite(d.pctPrevious) ? d.pctPrevious : 0)).pctPrevious;\r\n    return [\r\n      {\r\n        title: options.stepCol.displayAs,\r\n        dataIndex: \"step\",\r\n        width: \"25%\",\r\n        className: \"text-ellipsis\",\r\n        render: (text: any) => (\r\n          <Tooltip title={text} mouseEnterDelay={0} mouseLeaveDelay={0}>\r\n            {text}\r\n          </Tooltip>\r\n        ),\r\n      },\r\n      {\r\n        title: options.valueCol.displayAs,\r\n        dataIndex: \"value\",\r\n        width: \"45%\",\r\n        align: \"center\",\r\n        render: (value: any, item: any) => (\r\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\r\n          <FunnelBar align=\"center\" color={ColorPalette.Cyan} value={item.pctMax}>\r\n            {formatValue(value)}\r\n          </FunnelBar>\r\n        ),\r\n      },\r\n      {\r\n        title: \"% Max\",\r\n        dataIndex: \"pctMax\",\r\n        width: \"15%\",\r\n        align: \"center\",\r\n        render: (value: any) => formatPercentValue(value),\r\n      },\r\n      {\r\n        title: \"% Previous\",\r\n        dataIndex: \"pctPrevious\",\r\n        width: \"15%\",\r\n        align: \"center\",\r\n        render: (value: any) => (\r\n          // @ts-expect-error ts-migrate(2745) FIXME: This JSX tag's 'children' prop expects type 'never... Remove this comment to see the full error message\r\n          <FunnelBar className=\"funnel-percent-column\" value={(value / maxToPrevious) * 100.0}>\r\n            {formatPercentValue(value)}\r\n          </FunnelBar>\r\n        ),\r\n      },\r\n    ];\r\n  }, [options.stepCol.displayAs, options.valueCol.displayAs, funnelData, formatValue, formatPercentValue]);\r\n\r\n  if (funnelData.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"funnel-visualization-container\">\r\n      <Table\r\n        // @ts-expect-error ts-migrate(2322) FIXME: Type '({ title: any; dataIndex: string; width: str... Remove this comment to see the full error message\r\n        columns={columns}\r\n        dataSource={funnelData}\r\n        rowKey={(record, index) => rowKeyPrefix + index}\r\n        pagination={false}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nRenderer.propTypes = RendererPropTypes;\r\n"],"file":"index.js"}