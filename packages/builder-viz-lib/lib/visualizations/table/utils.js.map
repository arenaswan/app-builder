{"version":3,"sources":["../../../src/visualizations/table/utils.tsx"],"names":["nextOrderByDirection","direction","toggleOrderBy","columnName","orderBy","multiColumnSort","index","i","name","item","push","getOrderByInfo","result","prepareColumns","columns","searchInput","onOrderByChange","isMultiColumnSort","length","orderByInfo","tableColumns","column","isAscend","isDescend","sortColumnIndex","key","dataIndex","JSON","stringify","align","alignContent","sorter","multiple","sortOrder","title","description","paddingRight","onHeaderCell","className","onClick","event","shiftKey","initColumn","ColumnTypes","displayAs","Component","render","unused","row","children","record","props","initRows","rows","filterRows","searchTerm","searchColumns","toUpperCase","matchFields","prepareData","text","indexOf","match","sortRows","directions","ascend","descend","sort","a","b","va","vb"],"mappings":"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","sourcesContent":["import { isNil, map, get, filter, each, sortBy, some, findIndex, toString } from \"lodash\";\r\nimport React from \"react\";\r\nimport cx from \"classnames\";\r\nimport Tooltip from \"antd/lib/tooltip\";\r\nimport ColumnTypes from \"./columns\";\r\n\r\nfunction nextOrderByDirection(direction: any) {\r\n  switch (direction) {\r\n    case \"ascend\":\r\n      return \"descend\";\r\n    case \"descend\":\r\n      return null;\r\n    default:\r\n      return \"ascend\";\r\n  }\r\n}\r\n\r\nfunction toggleOrderBy(columnName: any, orderBy = [], multiColumnSort = false) {\r\n  // @ts-expect-error ts-migrate(2339) FIXME: Property 'name' does not exist on type 'never'.\r\n  const index = findIndex(orderBy, i => i.name === columnName);\r\n  const item = { name: columnName, direction: \"ascend\" };\r\n  if (index >= 0) {\r\n    // @ts-expect-error ts-migrate(2322) FIXME: Type 'string | null' is not assignable to type 'st... Remove this comment to see the full error message\r\n    item.direction = nextOrderByDirection(orderBy[index].direction);\r\n  }\r\n\r\n  if (multiColumnSort) {\r\n    if (!item.direction) {\r\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'name' does not exist on type 'never'.\r\n      return filter(orderBy, i => i.name !== columnName);\r\n    }\r\n    if (index >= 0) {\r\n      // @ts-expect-error ts-migrate(2322) FIXME: Type '{ name: any; direction: string; }' is not as... Remove this comment to see the full error message\r\n      orderBy[index] = item;\r\n    } else {\r\n      // @ts-expect-error ts-migrate(2345) FIXME: Argument of type '{ name: any; direction: string; ... Remove this comment to see the full error message\r\n      orderBy.push(item);\r\n    }\r\n    return [...orderBy];\r\n  }\r\n  return item.direction ? [item] : [];\r\n}\r\n\r\nfunction getOrderByInfo(orderBy: any) {\r\n  const result = {};\r\n  each(orderBy, ({ name, direction }, index) => {\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    result[name] = { direction, index: index + 1 };\r\n  });\r\n  return result;\r\n}\r\n\r\nexport function prepareColumns(columns: any, searchInput: any, orderBy: any, onOrderByChange: any) {\r\n  columns = filter(columns, \"visible\");\r\n  columns = sortBy(columns, \"order\");\r\n\r\n  const isMultiColumnSort = orderBy.length > 1;\r\n  const orderByInfo = getOrderByInfo(orderBy);\r\n\r\n  let tableColumns = map(columns, column => {\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    const isAscend = orderByInfo[column.name] && orderByInfo[column.name].direction === \"ascend\";\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    const isDescend = orderByInfo[column.name] && orderByInfo[column.name].direction === \"descend\";\r\n\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    const sortColumnIndex = isMultiColumnSort && orderByInfo[column.name] ? orderByInfo[column.name].index : null;\r\n\r\n    const result = {\r\n      key: column.name,\r\n      dataIndex: `record[${JSON.stringify(column.name)}]`,\r\n      align: column.alignContent,\r\n      sorter: { multiple: 1 }, // using { multiple: 1 } to allow built-in multi-column sort arrows\r\n      sortOrder: get(orderByInfo, [column.name, \"direction\"], null),\r\n      title: (\r\n        <React.Fragment>\r\n          {column.description && (\r\n            <span style={{ paddingRight: 5 }}>\r\n              <Tooltip placement=\"top\" title={column.description}>\r\n                <div className=\"table-visualization-heading\">\r\n                  <i className=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\r\n                </div>\r\n              </Tooltip>\r\n            </span>\r\n          )}\r\n          <Tooltip placement=\"top\" title={column.title}>\r\n            <div className=\"table-visualization-heading\" data-sort-column-index={sortColumnIndex}>\r\n              {column.title}\r\n            </div>\r\n          </Tooltip>\r\n        </React.Fragment>\r\n      ),\r\n      onHeaderCell: () => ({\r\n        className: cx({\r\n          \"table-visualization-column-is-sorted\": isAscend || isDescend,\r\n        }),\r\n        onClick: (event: any) => onOrderByChange(toggleOrderBy(column.name, orderBy, event.shiftKey)),\r\n      }),\r\n    };\r\n\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    const initColumn = ColumnTypes[column.displayAs];\r\n    const Component = initColumn(column);\r\n    // @ts-expect-error ts-migrate(2339) FIXME: Property 'render' does not exist on type '{ key: a... Remove this comment to see the full error message\r\n    result.render = (unused: any, row: any) => ({\r\n      children: <Component row={row.record} />,\r\n      props: { className: `display-as-${column.displayAs}` },\r\n    });\r\n\r\n    return result;\r\n  });\r\n\r\n  tableColumns.push({\r\n    key: \"###Redash::Visualizations::Table::Spacer###\",\r\n    // @ts-expect-error ts-migrate(2322) FIXME: Type 'null' is not assignable to type 'string'.\r\n    dataIndex: null,\r\n    // @ts-expect-error ts-migrate(2322) FIXME: Type 'string' is not assignable to type 'Element'.\r\n    title: \"\",\r\n    className: \"table-visualization-spacer\",\r\n    render: () => \"\",\r\n    // @ts-expect-error ts-migrate(2741) FIXME: Property 'onClick' is missing in type '{ className... Remove this comment to see the full error message\r\n    onHeaderCell: () => ({ className: \"table-visualization-spacer\" }),\r\n  });\r\n\r\n  if (searchInput) {\r\n    // Add searchInput as the ColumnGroup for all table columns\r\n    tableColumns = [\r\n      {\r\n        key: \"table-search\",\r\n        title: searchInput,\r\n        // @ts-expect-error ts-migrate(2741) FIXME: Property 'onClick' is missing in type '{ className... Remove this comment to see the full error message\r\n        onHeaderCell: () => ({ className: \"table-visualization-search\" }),\r\n        children: tableColumns,\r\n      },\r\n    ];\r\n  }\r\n\r\n  return tableColumns;\r\n}\r\n\r\nexport function initRows(rows: any) {\r\n  return map(rows, (record, index) => ({ key: `record${index}`, record }));\r\n}\r\n\r\nexport function filterRows(rows: any, searchTerm: any, searchColumns: any) {\r\n  if (searchTerm !== \"\" && searchColumns.length > 0) {\r\n    searchTerm = searchTerm.toUpperCase();\r\n    const matchFields = map(searchColumns, column => {\r\n      // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n      const initColumn = ColumnTypes[column.displayAs];\r\n      const { prepareData } = initColumn(column);\r\n      return (row: any) => {\r\n        const { text } = prepareData(row);\r\n        return (\r\n          toString(text)\r\n            .toUpperCase()\r\n            .indexOf(searchTerm) >= 0\r\n        );\r\n      };\r\n    });\r\n\r\n    return filter(rows, row => some(matchFields, match => match(row.record)));\r\n  }\r\n  return rows;\r\n}\r\n\r\nexport function sortRows(rows: any, orderBy: any) {\r\n  if (orderBy.length === 0 || rows.length === 0) {\r\n    return rows;\r\n  }\r\n\r\n  const directions = { ascend: 1, descend: -1 };\r\n\r\n  // Create a copy of array before sorting, because .sort() will modify original array\r\n  return [...rows].sort((a, b) => {\r\n    let va;\r\n    let vb;\r\n    for (let i = 0; i < orderBy.length; i += 1) {\r\n      va = a.record[orderBy[i].name];\r\n      vb = b.record[orderBy[i].name];\r\n      if (isNil(va) || va < vb) {\r\n        // if a < b - we should return -1, but take in account direction\r\n        // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n        return -1 * directions[orderBy[i].direction];\r\n      }\r\n      if (va > vb || isNil(vb)) {\r\n        // if a > b - we should return 1, but take in account direction\r\n        // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n        return 1 * directions[orderBy[i].direction];\r\n      }\r\n    }\r\n    return 0;\r\n  });\r\n}\r\n"],"file":"utils.js"}