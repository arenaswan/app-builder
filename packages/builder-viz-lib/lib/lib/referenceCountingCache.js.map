{"version":3,"sources":["../../src/lib/referenceCountingCache.ts"],"names":["createReferenceCountingCache","cleanupDelay","items","cleanup","item","key","refCount","get","getter","value","release"],"mappings":";;;;;;;AAAA;;AAEe,SAASA,4BAAT,GAAoE;AAAA,iFAAJ,EAAI;AAAA,+BAA5BC,YAA4B;AAAA,MAA5BA,YAA4B,kCAAb,IAAa;;AACjF,MAAMC,KAAK,GAAG,EAAd;AAEA,MAAMC,OAAO,GAAG,sBAAS,MAAM;AAC7B,sBAAKD,KAAL,EAAY,CAACE,IAAD,EAAOC,GAAP,KAAe;AACzB;AACA,UAAID,IAAI,CAACE,QAAL,IAAiB,CAArB,EAAwB;AACtB;AACA,eAAOJ,KAAK,CAACG,GAAD,CAAZ;AACD;AACF,KAND;AAOD,GARe,EAQbJ,YARa,CAAhB;;AAUA,WAASM,GAAT,CAAaF,GAAb,EAAuBG,MAAvB,EAAoC;AAClC;AACA,QAAI,CAACN,KAAK,CAACG,GAAD,CAAV,EAAiB;AACf;AACAH,MAAAA,KAAK,CAACG,GAAD,CAAL,GAAa;AACXI,QAAAA,KAAK,EAAED,MAAM,EADF;AAEXF,QAAAA,QAAQ,EAAE;AAFC,OAAb;AAID,KARiC,CASlC;;;AACA,QAAMF,IAAI,GAAGF,KAAK,CAACG,GAAD,CAAlB;AACAD,IAAAA,IAAI,CAACE,QAAL,IAAiB,CAAjB;AACA,WAAOF,IAAI,CAACK,KAAZ;AACD;;AAED,WAASC,OAAT,CAAiBL,GAAjB,EAA2B;AACzB;AACA,QAAIH,KAAK,CAACG,GAAD,CAAT,EAAgB;AACd;AACA,UAAMD,IAAI,GAAGF,KAAK,CAACG,GAAD,CAAlB;;AACA,UAAID,IAAI,CAACE,QAAL,GAAgB,CAApB,EAAuB;AACrBF,QAAAA,IAAI,CAACE,QAAL,IAAiB,CAAjB;;AACA,YAAIF,IAAI,CAACE,QAAL,IAAiB,CAArB,EAAwB;AACtBH,UAAAA,OAAO;AACR;AACF;AACF;AACF;;AAED,SAAO;AAAEI,IAAAA,GAAF;AAAOG,IAAAA;AAAP,GAAP;AACD","sourcesContent":["import { each, debounce } from \"lodash\";\r\n\r\nexport default function createReferenceCountingCache({ cleanupDelay = 2000 } = {}) {\r\n  const items = {};\r\n\r\n  const cleanup = debounce(() => {\r\n    each(items, (item, key) => {\r\n      // @ts-expect-error ts-migrate(2339) FIXME: Property 'refCount' does not exist on type 'never'... Remove this comment to see the full error message\r\n      if (item.refCount <= 0) {\r\n        // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n        delete items[key];\r\n      }\r\n    });\r\n  }, cleanupDelay);\r\n\r\n  function get(key: any, getter: any) {\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    if (!items[key]) {\r\n      // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n      items[key] = {\r\n        value: getter(),\r\n        refCount: 0,\r\n      };\r\n    }\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    const item = items[key];\r\n    item.refCount += 1;\r\n    return item.value;\r\n  }\r\n\r\n  function release(key: any) {\r\n    // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n    if (items[key]) {\r\n      // @ts-expect-error ts-migrate(7053) FIXME: Element implicitly has an 'any' type because expre... Remove this comment to see the full error message\r\n      const item = items[key];\r\n      if (item.refCount > 0) {\r\n        item.refCount -= 1;\r\n        if (item.refCount <= 0) {\r\n          cleanup();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return { get, release };\r\n}\r\n"],"file":"referenceCountingCache.js"}